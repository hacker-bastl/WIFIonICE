<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="//www.bahn.de/favicon.ico" rel="icon" type="image/x-icon" />
    <link href="//www.bahn.de/common/view/static/v8/img/db_em_rgb_100px.svg" rel="apple-touch-icon" type="image/svg" />

    <title> Visualization of ICE position using WiFi APIs </title>

    <!-- https://hannover.ccc.de/~nexus/dbwifi/chapter2.html -->
    <meta name="referrer" content="no-referrer" />
    <script type="text/javascript">

    const showICElocation = function() {
      var request = new XMLHttpRequest();
      request.addEventListener( 'load', function() {
        var longitude = request.responseXML.querySelector( 'longitude' ).textContent;
        var latitude = request.responseXML.querySelector( 'latitude' ).textContent;
        // http://wiki.openstreetmap.org/wiki/Browsing#bbox_URLs
        var iframeURL  = '//www.openstreetmap.org/export/embed.html?bbox=' +
          encodeURIComponent( longitude + ',' + latitude + ',' + longitude + ',' + latitude ):
        document.querySelector( 'iframe' ).setAttribute( 'src', iframeURL ); } );
      request.addEventListener( 'error', function() {
        alert( 'cannot access ICE WiFi (' + ( request.statusText || 'connection failed' ) + ')' ); } );
      request.open( 'GET', '//www.ombord.info/api/xml/position' );
      request.send( null ); };

    window.addEventListener( 'load', showICElocation );
    window.setInterval( showICElocation, 1E4 );

    </script>
    <style type="text/css">

    iframe {
      position: fixed;
      background: #fff;
      border: none;
      width: 100%;
      height: 100%;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

    </style>
  </head>
  <body>
    <iframe scrolling="no" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>
  </body>
</html>
